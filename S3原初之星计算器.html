<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S3åŸåˆä¹‹æ˜Ÿè®¡ç®—å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .table-wrapper {
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: linear-gradient(180deg, #2d3a4f 0%, #1e2836 100%);
            color: #ffd700;
            font-weight: 600;
        }

        td {
            background: rgba(255, 255, 255, 0.03);
        }

        .row-label {
            text-align: left;
            font-weight: 500;
            color: #a0c4ff;
            background: rgba(160, 196, 255, 0.1) !important;
        }

        /* ========== è¾“å…¥æ¡†æ ·å¼ ========== */
        
        /* éšè—æ•°å­—è¾“å…¥æ¡†çš„å¢å‡ç®­å¤´ */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* å•å…ƒæ ¼å†…è¾“å…¥æ¡† */
        .input-cell input {
            width: 80px;
            padding: 8px 12px;
            border: 2px solid #4a90d9;
            border-radius: 6px;
            background: rgba(74, 144, 217, 0.1);
            color: #fff;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .input-cell input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* è¡Œæ ‡ç­¾å†…åµŒè¾“å…¥æ¡† */
        .inline-input {
            width: 70px;
            padding: 4px 8px;
            border: 2px solid #4a90d9;
            border-radius: 4px;
            background: rgba(74, 144, 217, 0.1);
            color: #fff;
            font-size: 14px;
            text-align: center;
            margin-left: 5px;
        }

        .inline-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        /* ========== è¡¨æ ¼è¡Œæ ·å¼ ========== */

        /* è¯„åˆ†è¡Œ - ç»¿è‰² */
        .score-row td { color: #4ade80; font-weight: 600; }
        .score-row td.total-col,
        .score-row td.star-col { color: #4ade80 !important; }

        /* å‚è€ƒè¡Œ - ç°è‰² */
        .ref-row td { color: #94a3b8; font-size: 13px; }
        .ref-row td.total-col,
        .ref-row td.star-col { color: #94a3b8 !important; }

        /* å·®è·è¡Œ */
        .gap-row td { font-weight: 500; }
        .gap-row td.total-col.positive,
        .gap-row td.star-col.positive { color: #4ade80 !important; }
        .gap-row td.total-col.negative,
        .gap-row td.star-col.negative { color: #f87171 !important; }

        /* å¤‡æ³¨è¡Œ */
        .note-row td { font-size: 12px; color: #94a3b8; }
        .note-row .bonus-2 { color: #60a5fa; }
        .note-row .bonus-3 { color: #4ade80; }
        .note-row .bonus-double { color: #f472b6; }

        /* åˆ†éš”è¡Œ */
        .separator-row td {
            height: 20px;
            background: transparent;
            border: none;
        }

        /* ========== æ•°å€¼é¢œè‰²æ ·å¼ ========== */

        .negative { color: #f87171 !important; }  /* çº¢è‰² - è¿˜éœ€åŠªåŠ› */
        .positive { color: #4ade80 !important; }  /* ç»¿è‰² - å·²è¶…è¿‡ */

        /* ========== ç‰¹æ®Šåˆ—é«˜äº® ========== */

        /* æ€»è¯„åˆ†åˆ— - é‡‘è‰² */
        .total-col {
            background: rgba(255, 215, 0, 0.1) !important;
            color: #ffd700 !important;
            font-weight: 600;
        }

        /* åŸåˆä¹‹æ˜Ÿåˆ— - ç´«è‰² */
        .star-col {
            background: rgba(139, 92, 246, 0.1) !important;
            color: #a78bfa !important;
            font-weight: 600;
        }

        /* ========== é¢„è®¾è¡ŒèƒŒæ™¯ ========== */

        .preset-1 td { background: rgba(251, 191, 36, 0.05); }
        .preset-2 td { background: rgba(244, 114, 182, 0.05); }

        /* ========== ç‰ˆæƒä¿¡æ¯ ========== */

        .copyright {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #64748b;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ S3åŸåˆä¹‹æ˜Ÿè®¡ç®—å™¨</h1>
        
        <div class="table-wrapper">
            <table id="starTable">
                <thead>
                    <tr>
                        <th></th>
                        <th>è§’è‰²</th>
                        <th>æŠ€èƒ½</th>
                        <th>è£…å¤‡</th>
                        <th>å¹»å…½</th>
                        <th>é—ç‰©</th>
                        <th>æ€»è¯„åˆ†</th>
                        <th>åŸåˆä¹‹æ˜Ÿ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å¹³å‡ç­‰çº§è¡Œï¼ˆå¯è¾“å…¥ï¼‰ -->
                    <tr class="input-row">
                        <td class="row-label">å¹³å‡ç­‰çº§</td>
                        <td class="input-cell"><input type="number" id="level_role" value="260" step="1"></td>
                        <td class="input-cell"><input type="number" id="level_skill" value="250" step="1"></td>
                        <td class="input-cell"><input type="number" id="level_equip" value="250" step="1"></td>
                        <td class="input-cell"><input type="number" id="level_pet" value="240" step="1"></td>
                        <td class="input-cell"><input type="number" id="level_relic" value="25" step="1"></td>
                        <td class="total-col" id="total_score">26500</td>
                        <td class="star-col" id="star_score">2103</td>
                    </tr>
                    
                    <!-- è¯„åˆ†è¡Œ -->
                    <tr class="score-row">
                        <td class="row-label">è¯„åˆ†</td>
                        <td id="score_role">10000</td>
                        <td id="score_skill">3600</td>
                        <td id="score_equip">6300</td>
                        <td id="score_pet">1920</td>
                        <td id="score_relic">4680</td>
                        <td class="total-col">-</td>
                        <td class="star-col">å‘ä¸‹å–æ•´</td>
                    </tr>
                    
                    <!-- å‚è€ƒè¡Œ -->
                    <tr class="ref-row">
                        <td class="row-label">å‚è€ƒï¼šæ¯å‡1çº§å¹³å‡ç­‰çº§å¢åŠ çš„è¯„åˆ†</td>
                        <td id="ref_role">100</td>
                        <td id="ref_skill">40</td>
                        <td id="ref_equip">70</td>
                        <td id="ref_pet">24</td>
                        <td id="ref_relic">520</td>
                        <td class="total-col">-</td>
                        <td class="star-col" id="star_final">2103</td>
                    </tr>
                    
                    <!-- åˆ†éš”è¡Œ -->
                    <tr class="separator-row">
                        <td colspan="8"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- ç¬¬äºŒä¸ªè¡¨æ ¼ï¼šç›®æ ‡å·®è·è®¡ç®—ï¼ˆç‹¬ç«‹äºç¬¬ä¸€ä¸ªè¡¨æ ¼ï¼‰ -->
        <div class="table-wrapper" style="margin-top: 20px;">
            <table id="gapTable">
                <thead id="gapTableHead">
                    <!-- ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </thead>
                <tbody id="gapTableBody">
                    <!-- ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <!-- ç‰ˆæƒä¿¡æ¯ -->
        <footer class="copyright">
            Â© é­”åŠ›ç»½æ”¾-è“è“è·¯
        </footer>
    </div>

    <script>
        /* ==================== é…ç½®å¸¸é‡ ==================== */
        
        const INIT_LEVEL = {          // åˆå§‹ç­‰çº§
            role: 160,
            skill: 160,
            equip: 160,
            pet: 160,
            relic: 16
        };

        const SCORE_PER_LEVEL = {     // æ¯å‡1çº§å¢åŠ çš„è¯„åˆ†
            role: 100,
            skill: 40,
            equip: 70,
            pet: 24,
            relic: 520
        };

        const STAR_INIT = 65;         // åŸåˆä¹‹æ˜Ÿåˆå§‹å€¼
        const SCORE_PER_STAR = 13;    // æ¯é¢—åŸåˆä¹‹æ˜Ÿå¯¹åº”çš„è¯„åˆ†
        const LAST_SEASON_1 = 920;    // ä¸Šèµ›å­£é¢„è®¾å€¼1
        const LAST_SEASON_2 = 1200;   // ä¸Šèµ›å­£é¢„è®¾å€¼2

        // ç›®æ ‡åŸåˆä¹‹æ˜Ÿé…ç½®ï¼ˆæ•°é‡å¯å˜ï¼Œä¸ç¬¬ä¸€ä¸ªè¡¨æ ¼åˆ—æ•°æ— å…³ï¼‰
        // value: ç›®æ ‡å€¼, note: è¾¾æˆåçš„åŠ æˆè¯´æ˜, noteClass: å¤‡æ³¨æ ·å¼ç±»å
        const TARGET_STAR = [
            { value: 1880, note: 'ç»éªŒåŠ æˆ+2%', noteClass: 'bonus-2' },
            { value: 2360, note: 'ç»éªŒåŠ æˆ+2%', noteClass: 'bonus-2' },
            { value: 2880, note: 'ç»éªŒåŠ æˆ+2%', noteClass: 'bonus-2' },
            { value: 3020, note: 'å‡å3%', noteClass: 'bonus-3' },
            { value: 3300, note: 'ç¿»å€2%', noteClass: 'bonus-double' },
            { value: 3440, note: 'ç»éªŒåŠ æˆ+2%', noteClass: 'bonus-2' },
            { value: 4040, note: 'ç»éªŒåŠ æˆ+2%', noteClass: 'bonus-2' }
        ];

        /* ==================== DOM å…ƒç´ å¼•ç”¨ ==================== */

        // ç­‰çº§è¾“å…¥æ¡†
        const inputs = {
            role: document.getElementById('level_role'),
            skill: document.getElementById('level_skill'),
            equip: document.getElementById('level_equip'),
            pet: document.getElementById('level_pet'),
            relic: document.getElementById('level_relic')
        };

        // è¯„åˆ†æ˜¾ç¤º
        const scores = {
            role: document.getElementById('score_role'),
            skill: document.getElementById('score_skill'),
            equip: document.getElementById('score_equip'),
            pet: document.getElementById('score_pet'),
            relic: document.getElementById('score_relic')
        };

        // æ€»è®¡æ˜¾ç¤º
        const totals = {
            total: document.getElementById('total_score'),
            star: document.getElementById('star_score'),
            starFinal: document.getElementById('star_final')
        };

        // ç¬¬äºŒä¸ªè¡¨æ ¼å®¹å™¨
        const gapTableHead = document.getElementById('gapTableHead');
        const gapTableBody = document.getElementById('gapTableBody');
        
        // è‡ªå®šä¹‰ä¸Šèµ›å­£è¾“å…¥æ¡†å¼•ç”¨ï¼ˆåˆå§‹åŒ–åè®¾ç½®ï¼‰
        let customLastSeasonInput = null;

        /* ==================== è®¡ç®—å‡½æ•° ==================== */

        /**
         * è®¡ç®—å•é¡¹è¯„åˆ†
         * å…¬å¼: (å½“å‰ç­‰çº§ - åˆå§‹ç­‰çº§) Ã— æ¯çº§è¯„åˆ†
         */
        function calculateScore(type, level) {
            return Math.floor((level - INIT_LEVEL[type]) * SCORE_PER_LEVEL[type]);
        }

        /**
         * è®¡ç®—æ€»è¯„åˆ†ï¼ˆæ‰€æœ‰å•é¡¹è¯„åˆ†ä¹‹å’Œï¼‰
         */
        function calculateTotalScore() {
            let total = 0;
            for (const type in scores) {
                total += parseInt(scores[type].textContent) || 0;
            }
            return total;
        }

        /**
         * è®¡ç®—åŸåˆä¹‹æ˜Ÿ
         * å…¬å¼: æ€»è¯„åˆ† Ã· æ¯é¢—æ˜Ÿè¯„åˆ† + åˆå§‹å€¼
         */
        function calculateStarScore(totalScore) {
            return totalScore / SCORE_PER_STAR + STAR_INIT;
        }

        /**
         * è®¡ç®—è¾¾æˆç›®æ ‡æ‰€éœ€çš„å·®å€¼
         * å…¬å¼: (ç›®æ ‡åŸåˆä¹‹æ˜Ÿ - ä¸Šèµ›å­£åŸåˆä¹‹æ˜Ÿ - åˆå§‹å€¼) Ã— æ¯é¢—æ˜Ÿè¯„åˆ† - å½“å‰æ€»è¯„åˆ†
         * ç»“æœ: è´Ÿæ•°=å·²è¶…è¿‡ç›®æ ‡, æ­£æ•°=è¿˜éœ€åŠªåŠ›
         */
        function calculateS2Gap(targetStar, lastSeasonStar, totalScore) {
            return (targetStar - lastSeasonStar - STAR_INIT) * SCORE_PER_STAR - totalScore;
        }

        /* ==================== ç•Œé¢æ›´æ–°å‡½æ•° ==================== */

        /**
         * åˆå§‹åŒ–ç¬¬äºŒä¸ªè¡¨æ ¼ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰
         */
        function initGapTable() {
            // ç”Ÿæˆè¡¨å¤´ï¼ˆç¦»ç›®æ ‡å·®è·è¯„åˆ†â†“ + ç›®æ ‡åŸåˆä¹‹æ˜Ÿå€¼ï¼‰
            let headHtml = '<tr><th>ç¦»ç›®æ ‡å·®è·è¯„åˆ†â†“</th>';
            for (let i = 0; i < TARGET_STAR.length; i++) {
                headHtml += `<th>${TARGET_STAR[i].value}</th>`;
            }
            headHtml += '</tr>';
            gapTableHead.innerHTML = headHtml;
            
            // ç”Ÿæˆè¡¨ä½“
            let bodyHtml = '';
            
            // ä¸Šèµ›å­£é¢„è®¾å€¼1è¡Œ
            bodyHtml += '<tr class="gap-row preset-1" id="preset1Row"><td class="row-label">S2è¾¾åˆ°' + LAST_SEASON_1 + '</td>';
            for (let i = 0; i < TARGET_STAR.length; i++) {
                bodyHtml += `<td id="preset1_${i}">-</td>`;
            }
            bodyHtml += '</tr>';
            
            // ä¸Šèµ›å­£é¢„è®¾å€¼2è¡Œ
            bodyHtml += '<tr class="gap-row preset-2" id="preset2Row"><td class="row-label">S2è¾¾åˆ°' + LAST_SEASON_2 + '</td>';
            for (let i = 0; i < TARGET_STAR.length; i++) {
                bodyHtml += `<td id="preset2_${i}">-</td>`;
            }
            bodyHtml += '</tr>';
            
            // ä¸Šèµ›å­£è¾¾åˆ°è‡ªå®šä¹‰å€¼è¡Œ
            bodyHtml += '<tr class="gap-row" id="customRow"><td class="row-label">S2è¾¾åˆ°<input type="number" id="custom_last_season" value="" placeholder="è‡ªå®šä¹‰" step="1" class="inline-input"></td>';
            for (let i = 0; i < TARGET_STAR.length; i++) {
                bodyHtml += `<td id="custom_${i}">-</td>`;
            }
            bodyHtml += '</tr>';
            
            // å¤‡æ³¨è¡Œ
            bodyHtml += '<tr class="note-row"><td class="row-label">å¤‡æ³¨ï¼šæ­¤ç›®æ ‡çš„åŠ æˆ</td>';
            for (let i = 0; i < TARGET_STAR.length; i++) {
                const item = TARGET_STAR[i];
                bodyHtml += `<td class="${item.noteClass}">${item.note}</td>`;
            }
            bodyHtml += '</tr>';
            
            gapTableBody.innerHTML = bodyHtml;
            
            // è®¾ç½®è‡ªå®šä¹‰è¾“å…¥æ¡†å¼•ç”¨å¹¶ç»‘å®šäº‹ä»¶
            customLastSeasonInput = document.getElementById('custom_last_season');
            customLastSeasonInput.addEventListener('input', updateDisplay);
        }

        /**
         * æ›´æ–°æ‰€æœ‰æ˜¾ç¤ºå†…å®¹
         */
        function updateDisplay() {
            // æ›´æ–°å„é¡¹è¯„åˆ†
            for (const type in inputs) {
                const level = parseInt(inputs[type].value) || 0;
                scores[type].textContent = calculateScore(type, level);
            }

            // æ›´æ–°æ€»è¯„åˆ†å’ŒåŸåˆä¹‹æ˜Ÿ
            const totalScore = calculateTotalScore();
            const starScore = Math.floor(calculateStarScore(totalScore));
            
            totals.total.textContent = totalScore;
            totals.star.textContent = starScore;
            totals.starFinal.textContent = starScore;

            // æ›´æ–°å·®è·æ˜¾ç¤º
            updateGapDisplay();
        }

        /**
         * æ›´æ–°å·®è·æ˜¾ç¤ºï¼ˆç¬¬äºŒä¸ªè¡¨æ ¼ï¼‰
         */
        function updateGapDisplay() {
            const totalScore = parseInt(totals.total.textContent) || 0;
            const customValue = customLastSeasonInput ? customLastSeasonInput.value.trim() : '';
            const hasCustomValue = customValue !== '';
            const customLastSeason = hasCustomValue ? parseInt(customValue) : 0;
            
            for (let i = 0; i < TARGET_STAR.length; i++) {
                const targetStar = TARGET_STAR[i].value;
                
                // æ›´æ–°å·®è·è¡Œ
                document.getElementById(`preset1_${i}`).textContent = calculateS2Gap(targetStar, LAST_SEASON_1, totalScore);
                document.getElementById(`preset2_${i}`).textContent = calculateS2Gap(targetStar, LAST_SEASON_2, totalScore);
                document.getElementById(`custom_${i}`).textContent = hasCustomValue ? calculateS2Gap(targetStar, customLastSeason, totalScore) : '-';
            }
            
            applyNumberStyles();
        }

        /**
         * åº”ç”¨æ­£è´Ÿæ•°é¢œè‰²æ ·å¼
         * è´Ÿæ•°(å·²è¶…è¿‡)=ç»¿è‰², æ­£æ•°(è¿˜å·®)=çº¢è‰²
         */
        function applyNumberStyles() {
            document.querySelectorAll('.gap-row td:not(.row-label)').forEach(cell => {
                const value = parseFloat(cell.textContent);
                cell.classList.remove('positive', 'negative');
                
                if (!isNaN(value)) {
                    cell.classList.add(value < 0 ? 'positive' : value > 0 ? 'negative' : '');
                }
            });
        }

        /* ==================== äº‹ä»¶ç»‘å®šä¸åˆå§‹åŒ– ==================== */

        // ç»‘å®šç­‰çº§è¾“å…¥äº‹ä»¶
        for (const type in inputs) {
            inputs[type].addEventListener('input', updateDisplay);
        }

        // åˆå§‹åŒ–ç¬¬äºŒä¸ªè¡¨æ ¼
        initGapTable();

        // åˆå§‹åŒ–æ˜¾ç¤º
        updateDisplay();
    </script>
</body>
</html>
